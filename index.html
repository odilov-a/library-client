<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search Books</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div>
        <h2>Search Books</h2>
        <a href="./login.html">Login for admins</a>
      </div>
      <form id="bookSearchForm">
        <div class="row mt-3">
          <div class="col-md-3">
            <label for="title" class="form-label">Title</label>
            <input
              type="text"
              class="form-control"
              id="title"
              placeholder="Enter title"
            />
          </div>
          <div class="col-md-3">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" id="category" name="category">
              <option value="">Select a category</option>
              <option value="Category">Category</option>
              <option value="non-fiction">Non-Fiction</option>
              <option value="fantasy">Fantasy</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="author" class="form-label">Author</label>
            <select class="form-select" id="author" name="author">
              <option value="">Select a author</option>
              <option value="Author">Author</option>
              <option value="non-fiction">Non-Fiction</option>
              <option value="fantasy">Fantasy</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="publisher" class="form-label">Publisher</label>
            <select class="form-select" id="publisher" name="publisher">
              <option value="">Select a publisher</option>
              <option value="Publisher">Publisher</option>
              <option value="non-fiction">Non-Fiction</option>
              <option value="fantasy">Fantasy</option>
            </select>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-md-4">
            <label for="year" class="form-label">Year</label>
            <input
              type="text"
              class="form-control"
              id="year"
              placeholder="Enter year"
            />
          </div>
          <div class="col-md-4">
            <label for="startYear" class="form-label">Start Year</label>
            <input
              type="text"
              class="form-control"
              id="startYear"
              placeholder="Enter start year"
            />
          </div>
          <div class="col-md-4">
            <label for="endYear" class="form-label">End Year</label>
            <input
              type="text"
              class="form-control"
              id="endYear"
              placeholder="Enter end year"
            />
          </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">
          <i class="bi bi-search"></i> Search
        </button>
      </form>
      <div id="bookResults" class="mt-3"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <script>
      const searchBooks = async () => {
        const title = document.getElementById("title").value;
        const author = document.getElementById("author").value;
        const category = document.getElementById("category").value;
        const publisher = document.getElementById("publisher").value;
        const year = document.getElementById("year").value;
        const startYear = document.getElementById("startYear").value;
        const endYear = document.getElementById("endYear").value;
        const url = `http://localhost:3333/api/books/search?title=${title}&author=${author}&category=${category}&publisher=${publisher}&year=${year}&startYear=${startYear}&endYear=${endYear}`;
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Failed to fetch data");
          }
          const data = await response.json();
          displayBooks(data);
        } catch (error) {
          console.error("Error:", error);
          displayNoBooksFound();
        }
      };
      const displayBooks = (data) => {
        const bookResults = document.getElementById("bookResults");
        bookResults.innerHTML = "";
        if (data.data.length === 0) {
          displayNoBooksFound();
          return;
        }
        const books = data.data;
        const table = `
          <table class="table">
            <thead class="table-light">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Title</th>
                <th scope="col">Author</th>
                <th scope="col">Category</th>
                <th scope="col">Year</th>
                <th scope="col">Publisher</th>
                <th scope="col">Description</th>
                <th scope="col">Count</th>
                <th scope="col">Image</th>
              </tr>
            </thead>
            <tbody>
              ${books
                .map(
                  (book) => `
                <tr>
                  <td>${book._id}</td>
                  <td>${book.title}</td>
                  <td>${book.author}</td>
                  <td>${book.category}</td>
                  <td>${book.year}</td>
                  <td>${book.publisher}</td>
                  <td>${book.description}</td>
                  <td>${book.count}</td>
                  <td><img src="${book.image[0].medium}" alt="${book.title}" style="max-width: 100px; max-height: 100px;"></td>
                </tr>
              `
                )
                .join("")}
            </tbody>
          </table>
        `;
        bookResults.innerHTML = table;
      };
      const displayNoBooksFound = () => {
        Swal.fire({
          icon: "info",
          title: "No Books Found",
          text: "No books found matching the search criteria",
        });
      };
      document
        .getElementById("bookSearchForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          searchBooks();
        });
    </script>
  </body>
</html>
